---
- name : Deploy Pods on Docker Container
  hosts : kubernetes
  connection: local
  gather_facts: false
  remote_user: kubernetes-admin
  tasks :  
  - name: install pre-requisites
    register: prereqoutput
    pip:
      name:
        - openshift
        - pyyaml
        - kubernetes 
        
  - name: get pwd value
    command: pwd
    register: pwdout
  - name: display pwd output
    debug:
      msg: "{{ pwdout }}"
  - name: copy config
    copy:
      src: $HOME/.kube/config
      dest: .
      register: copyout
  - name: display copy config output
    debug:
      msg: "{{ copyout }}"
      
  - name: Create namespace
    register: creatensoutput
    k8s:
      kubeconfig: $HOME/.kube/config
      context: kubernetes-admin@kubernetes
      name: sample
      api_version: v1
      kind: Namespace
      state: present

  - name: display ns output 
    debug:
      msg: "{{ creatensoutput.stdout_lines}}"
            
  - name: Remove Existing Container
    command: "kubectl delete deployment {{ containerName }} -ns sample"
    ignore_errors: true

  - name: Performing Deployment of {{ dockerImageTag }}
    command: "kubectl create deployment {{ containerName }} --image=docker.io/{{ dockerImageTag }} --port={{ httpPort }} -ns sample "

  - name: Get Container List
    command: "kubectl get pods -o wide -ns sample"
